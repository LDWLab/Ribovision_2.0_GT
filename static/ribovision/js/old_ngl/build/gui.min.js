// File:js/lib/tether.min.js

if( typeof importScripts !== 'function' ){
!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e(require,exports,module):t.Tether=e()}(this,function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t){var e=getComputedStyle(t),o=e.position;if("fixed"===o)return t;for(var i=t;i=i.parentNode;){var n=void 0;try{n=getComputedStyle(i)}catch(r){}if("undefined"==typeof n||null===n)return i;var s=n.overflow,a=n.overflowX,f=n.overflowY;if(/(auto|scroll)/.test(s+f+a)&&("absolute"!==o||["relative","absolute","fixed"].indexOf(n.position)>=0))return i}return document.body}function r(t){var e=void 0;t===document?(e=document,t=document.documentElement):e=t.ownerDocument;var o=e.documentElement,i={},n=t.getBoundingClientRect();for(var r in n)i[r]=n[r];var s=x(e);return i.top-=s.top,i.left-=s.left,"undefined"==typeof i.width&&(i.width=document.body.scrollWidth-i.left-i.right),"undefined"==typeof i.height&&(i.height=document.body.scrollHeight-i.top-i.bottom),i.top=i.top-o.clientTop,i.left=i.left-o.clientLeft,i.right=e.body.clientWidth-i.width-i.left,i.bottom=e.body.clientHeight-i.height-i.top,i}function s(t){return t.offsetParent||document.documentElement}function a(){var t=document.createElement("div");t.style.width="100%",t.style.height="200px";var e=document.createElement("div");f(e.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),e.appendChild(t),document.body.appendChild(e);var o=t.offsetWidth;e.style.overflow="scroll";var i=t.offsetWidth;o===i&&(i=e.clientWidth),document.body.removeChild(e);var n=o-i;return{width:n,height:n}}function f(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=[];return Array.prototype.push.apply(e,arguments),e.slice(1).forEach(function(e){if(e)for(var o in e)({}).hasOwnProperty.call(e,o)&&(t[o]=e[o])}),t}function h(t,e){if("undefined"!=typeof t.classList)e.split(" ").forEach(function(e){e.trim()&&t.classList.remove(e)});else{var o=new RegExp("(^| )"+e.split(" ").join("|")+"( |$)","gi"),i=u(t).replace(o," ");p(t,i)}}function l(t,e){if("undefined"!=typeof t.classList)e.split(" ").forEach(function(e){e.trim()&&t.classList.add(e)});else{h(t,e);var o=u(t)+(" "+e);p(t,o)}}function d(t,e){if("undefined"!=typeof t.classList)return t.classList.contains(e);var o=u(t);return new RegExp("(^| )"+e+"( |$)","gi").test(o)}function u(t){return t.className instanceof SVGAnimatedString?t.className.baseVal:t.className}function p(t,e){t.setAttribute("class",e)}function c(t,e,o){o.forEach(function(o){-1===e.indexOf(o)&&d(t,o)&&h(t,o)}),e.forEach(function(e){d(t,e)||l(t,e)})}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){var o=arguments.length<=2||void 0===arguments[2]?1:arguments[2];return t+o>=e&&e>=t-o}function m(){return"undefined"!=typeof performance&&"undefined"!=typeof performance.now?performance.now():+new Date}function v(){for(var t={top:0,left:0},e=arguments.length,o=Array(e),i=0;e>i;i++)o[i]=arguments[i];return o.forEach(function(e){var o=e.top,i=e.left;"string"==typeof o&&(o=parseFloat(o,10)),"string"==typeof i&&(i=parseFloat(i,10)),t.top+=o,t.left+=i}),t}function y(t,e){return"string"==typeof t.left&&-1!==t.left.indexOf("%")&&(t.left=parseFloat(t.left,10)/100*e.width),"string"==typeof t.top&&-1!==t.top.indexOf("%")&&(t.top=parseFloat(t.top,10)/100*e.height),t}function b(t,e){return"scrollParent"===e?e=t.scrollParent:"window"===e&&(e=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),e===document&&(e=e.documentElement),"undefined"!=typeof e.nodeType&&!function(){var t=r(e),o=t,i=getComputedStyle(e);e=[o.left,o.top,t.width+o.left,t.height+o.top],U.forEach(function(t,o){t=t[0].toUpperCase()+t.substr(1),"Top"===t||"Left"===t?e[o]+=parseFloat(i["border"+t+"Width"]):e[o]-=parseFloat(i["border"+t+"Width"])})}(),e}var w=function(){function t(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,o,i){return o&&t(e.prototype,o),i&&t(e,i),e}}(),C=void 0;"undefined"==typeof C&&(C={modules:[]});var O=function(){var t=0;return function(){return++t}}(),E={},x=function(t){var e=t._tetherZeroElement;"undefined"==typeof e&&(e=t.createElement("div"),e.setAttribute("data-tether-id",O()),f(e.style,{top:0,left:0,position:"absolute"}),t.body.appendChild(e),t._tetherZeroElement=e);var o=e.getAttribute("data-tether-id");if("undefined"==typeof E[o]){E[o]={};var i=e.getBoundingClientRect();for(var n in i)E[o][n]=i[n];T(function(){delete E[o]})}return E[o]},A=[],T=function(t){A.push(t)},S=function(){for(var t=void 0;t=A.pop();)t()},W=function(){function t(){i(this,t)}return w(t,[{key:"on",value:function(t,e,o){var i=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];"undefined"==typeof this.bindings&&(this.bindings={}),"undefined"==typeof this.bindings[t]&&(this.bindings[t]=[]),this.bindings[t].push({handler:e,ctx:o,once:i})}},{key:"once",value:function(t,e,o){this.on(t,e,o,!0)}},{key:"off",value:function(t,e){if("undefined"==typeof this.bindings||"undefined"==typeof this.bindings[t])if("undefined"==typeof e)delete this.bindings[t];else for(var o=0;o<this.bindings[t].length;)this.bindings[t][o].handler===e?this.bindings[t].splice(o,1):++o}},{key:"trigger",value:function(t){if("undefined"!=typeof this.bindings&&this.bindings[t])for(var e=0;e<this.bindings[t].length;){var o=this.bindings[t][e],i=o.handler,n=o.ctx,r=o.once,s=n;"undefined"==typeof s&&(s=this);for(var a=arguments.length,f=Array(a>1?a-1:0),h=1;a>h;h++)f[h-1]=arguments[h];i.apply(s,f),r?this.bindings[t].splice(e,1):++e}}}]),t}();C.Utils={getScrollParent:n,getBounds:r,getOffsetParent:s,extend:f,addClass:l,removeClass:h,hasClass:d,updateClasses:c,defer:T,flush:S,uniqueId:O,Evented:W,getScrollBarSize:a};var M=function(){function t(t,e){var o=[],i=!0,n=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(o.push(s.value),!e||o.length!==e);i=!0);}catch(f){n=!0,r=f}finally{try{!i&&a["return"]&&a["return"]()}finally{if(n)throw r}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),w=function(){function t(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,o,i){return o&&t(e.prototype,o),i&&t(e,i),e}}();if("undefined"==typeof C)throw new Error("You must include the utils.js file before tether.js");var P=C.Utils,n=P.getScrollParent,r=P.getBounds,s=P.getOffsetParent,f=P.extend,l=P.addClass,h=P.removeClass,c=P.updateClasses,T=P.defer,S=P.flush,a=P.getScrollBarSize,k=function(){for(var t=document.createElement("div"),e=["transform","webkitTransform","OTransform","MozTransform","msTransform"],o=0;o<e.length;++o){var i=e[o];if(void 0!==t.style[i])return i}}(),B=[],_=function(){B.forEach(function(t){t.position(!1)}),S()};!function(){var t=null,e=null,o=null,i=function n(){return"undefined"!=typeof e&&e>16?(e=Math.min(e-16,250),void(o=setTimeout(n,250))):void("undefined"!=typeof t&&m()-t<10||("undefined"!=typeof o&&(clearTimeout(o),o=null),t=m(),_(),e=m()-t))};["resize","scroll","touchmove"].forEach(function(t){window.addEventListener(t,i)})}();var z={center:"center",left:"right",right:"left"},F={middle:"middle",top:"bottom",bottom:"top"},L={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},Y=function(t,e){var o=t.left,i=t.top;return"auto"===o&&(o=z[e.left]),"auto"===i&&(i=F[e.top]),{left:o,top:i}},H=function(t){var e=t.left,o=t.top;return"undefined"!=typeof L[t.left]&&(e=L[t.left]),"undefined"!=typeof L[t.top]&&(o=L[t.top]),{left:e,top:o}},X=function(t){var e=t.split(" "),o=M(e,2),i=o[0],n=o[1];return{top:i,left:n}},j=X,N=function(){function t(e){var o=this;i(this,t),this.position=this.position.bind(this),B.push(this),this.history=[],this.setOptions(e,!1),C.modules.forEach(function(t){"undefined"!=typeof t.initialize&&t.initialize.call(o)}),this.position()}return w(t,[{key:"getClass",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=this.options.classes;return"undefined"!=typeof e&&e[t]?this.options.classes[t]:this.options.classPrefix?this.options.classPrefix+"-"+t:t}},{key:"setOptions",value:function(t){var e=this,o=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],i={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"};this.options=f(i,t);var r=this.options,s=r.element,a=r.target,h=r.targetModifier;if(this.element=s,this.target=a,this.targetModifier=h,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),["element","target"].forEach(function(t){if("undefined"==typeof e[t])throw new Error("Tether Error: Both element and target must be defined");"undefined"!=typeof e[t].jquery?e[t]=e[t][0]:"string"==typeof e[t]&&(e[t]=document.querySelector(e[t]))}),l(this.element,this.getClass("element")),this.options.addTargetClasses!==!1&&l(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");this.targetAttachment=j(this.options.targetAttachment),this.attachment=j(this.options.attachment),this.offset=X(this.options.offset),this.targetOffset=X(this.options.targetOffset),"undefined"!=typeof this.scrollParent&&this.disable(),this.scrollParent="scroll-handle"===this.targetModifier?this.target:n(this.target),this.options.enabled!==!1&&this.enable(o)}},{key:"getTargetBounds",value:function(){if("undefined"==typeof this.targetModifier)return r(this.target);if("visible"===this.targetModifier){if(this.target===document.body)return{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth};var t=r(this.target),e={height:t.height,width:t.width,top:t.top,left:t.left};return e.height=Math.min(e.height,t.height-(pageYOffset-t.top)),e.height=Math.min(e.height,t.height-(t.top+t.height-(pageYOffset+innerHeight))),e.height=Math.min(innerHeight,e.height),e.height-=2,e.width=Math.min(e.width,t.width-(pageXOffset-t.left)),e.width=Math.min(e.width,t.width-(t.left+t.width-(pageXOffset+innerWidth))),e.width=Math.min(innerWidth,e.width),e.width-=2,e.top<pageYOffset&&(e.top=pageYOffset),e.left<pageXOffset&&(e.left=pageXOffset),e}if("scroll-handle"===this.targetModifier){var t=void 0,o=this.target;o===document.body?(o=document.documentElement,t={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):t=r(o);var i=getComputedStyle(o),n=o.scrollWidth>o.clientWidth||[i.overflow,i.overflowX].indexOf("scroll")>=0||this.target!==document.body,s=0;n&&(s=15);var a=t.height-parseFloat(i.borderTopWidth)-parseFloat(i.borderBottomWidth)-s,e={width:15,height:.975*a*(a/o.scrollHeight),left:t.left+t.width-parseFloat(i.borderLeftWidth)-15},f=0;408>a&&this.target===document.body&&(f=-11e-5*Math.pow(a,2)-.00727*a+22.58),this.target!==document.body&&(e.height=Math.max(e.height,24));var h=this.target.scrollTop/(o.scrollHeight-a);return e.top=h*(a-e.height-f)+t.top+parseFloat(i.borderTopWidth),this.target===document.body&&(e.height=Math.max(e.height,24)),e}}},{key:"clearCache",value:function(){this._cache={}}},{key:"cache",value:function(t,e){return"undefined"==typeof this._cache&&(this._cache={}),"undefined"==typeof this._cache[t]&&(this._cache[t]=e.call(this)),this._cache[t]}},{key:"enable",value:function(){var t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];this.options.addTargetClasses!==!1&&l(this.target,this.getClass("enabled")),l(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParent!==document&&this.scrollParent.addEventListener("scroll",this.position),t&&this.position()}},{key:"disable",value:function(){h(this.target,this.getClass("enabled")),h(this.element,this.getClass("enabled")),this.enabled=!1,"undefined"!=typeof this.scrollParent&&this.scrollParent.removeEventListener("scroll",this.position)}},{key:"destroy",value:function(){var t=this;this.disable(),B.forEach(function(e,o){return e===t?void B.splice(o,1):void 0})}},{key:"updateAttachClasses",value:function(t,e){var o=this;t=t||this.attachment,e=e||this.targetAttachment;var i=["left","top","bottom","right","middle","center"];"undefined"!=typeof this._addAttachClasses&&this._addAttachClasses.length&&this._addAttachClasses.splice(0,this._addAttachClasses.length),"undefined"==typeof this._addAttachClasses&&(this._addAttachClasses=[]);var n=this._addAttachClasses;t.top&&n.push(this.getClass("element-attached")+"-"+t.top),t.left&&n.push(this.getClass("element-attached")+"-"+t.left),e.top&&n.push(this.getClass("target-attached")+"-"+e.top),e.left&&n.push(this.getClass("target-attached")+"-"+e.left);var r=[];i.forEach(function(t){r.push(o.getClass("element-attached")+"-"+t),r.push(o.getClass("target-attached")+"-"+t)}),T(function(){"undefined"!=typeof o._addAttachClasses&&(c(o.element,o._addAttachClasses,r),o.options.addTargetClasses!==!1&&c(o.target,o._addAttachClasses,r),delete o._addAttachClasses)})}},{key:"position",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];if(this.enabled){this.clearCache();var o=Y(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,o);var i=this.cache("element-bounds",function(){return r(t.element)}),n=i.width,f=i.height;if(0===n&&0===f&&"undefined"!=typeof this.lastSize){var h=this.lastSize;n=h.width,f=h.height}else this.lastSize={width:n,height:f};var l=this.cache("target-bounds",function(){return t.getTargetBounds()}),d=l,u=y(H(this.attachment),{width:n,height:f}),p=y(H(o),d),c=y(this.offset,{width:n,height:f}),g=y(this.targetOffset,d);u=v(u,c),p=v(p,g);for(var m=l.left+p.left-u.left,b=l.top+p.top-u.top,w=0;w<C.modules.length;++w){var O=C.modules[w],E=O.position.call(this,{left:m,top:b,targetAttachment:o,targetPos:l,elementPos:i,offset:u,targetOffset:p,manualOffset:c,manualTargetOffset:g,scrollbarSize:A,attachment:this.attachment});if(E===!1)return!1;"undefined"!=typeof E&&"object"==typeof E&&(b=E.top,m=E.left)}var x={page:{top:b,left:m},viewport:{top:b-pageYOffset,bottom:pageYOffset-b-f+innerHeight,left:m-pageXOffset,right:pageXOffset-m-n+innerWidth}},A=void 0;return document.body.scrollWidth>window.innerWidth&&(A=this.cache("scrollbar-size",a),x.viewport.bottom-=A.height),document.body.scrollHeight>window.innerHeight&&(A=this.cache("scrollbar-size",a),x.viewport.right-=A.width),(-1===["","static"].indexOf(document.body.style.position)||-1===["","static"].indexOf(document.body.parentElement.style.position))&&(x.page.bottom=document.body.scrollHeight-b-f,x.page.right=document.body.scrollWidth-m-n),"undefined"!=typeof this.options.optimizations&&this.options.optimizations.moveElement!==!1&&"undefined"==typeof this.targetModifier&&!function(){var e=t.cache("target-offsetparent",function(){return s(t.target)}),o=t.cache("target-offsetparent-bounds",function(){return r(e)}),i=getComputedStyle(e),n=o,a={};if(["Top","Left","Bottom","Right"].forEach(function(t){a[t.toLowerCase()]=parseFloat(i["border"+t+"Width"])}),o.right=document.body.scrollWidth-o.left-n.width+a.right,o.bottom=document.body.scrollHeight-o.top-n.height+a.bottom,x.page.top>=o.top+a.top&&x.page.bottom>=o.bottom&&x.page.left>=o.left+a.left&&x.page.right>=o.right){var f=e.scrollTop,h=e.scrollLeft;x.offset={top:x.page.top-o.top+f-a.top,left:x.page.left-o.left+h-a.left}}}(),this.move(x),this.history.unshift(x),this.history.length>3&&this.history.pop(),e&&S(),!0}}},{key:"move",value:function(t){var e=this;if("undefined"!=typeof this.element.parentNode){var o={};for(var i in t){o[i]={};for(var n in t[i]){for(var r=!1,a=0;a<this.history.length;++a){var h=this.history[a];if("undefined"!=typeof h[i]&&!g(h[i][n],t[i][n])){r=!0;break}}r||(o[i][n]=!0)}}var l={top:"",left:"",right:"",bottom:""},d=function(t,o){var i="undefined"!=typeof e.options.optimizations,n=i?e.options.optimizations.gpu:null;if(n!==!1){var r=void 0,s=void 0;t.top?(l.top=0,r=o.top):(l.bottom=0,r=-o.bottom),t.left?(l.left=0,s=o.left):(l.right=0,s=-o.right),l[k]="translateX("+Math.round(s)+"px) translateY("+Math.round(r)+"px)","msTransform"!==k&&(l[k]+=" translateZ(0)")}else t.top?l.top=o.top+"px":l.bottom=o.bottom+"px",t.left?l.left=o.left+"px":l.right=o.right+"px"},u=!1;if((o.page.top||o.page.bottom)&&(o.page.left||o.page.right)?(l.position="absolute",d(o.page,t.page)):(o.viewport.top||o.viewport.bottom)&&(o.viewport.left||o.viewport.right)?(l.position="fixed",d(o.viewport,t.viewport)):"undefined"!=typeof o.offset&&o.offset.top&&o.offset.left?!function(){l.position="absolute";var i=e.cache("target-offsetparent",function(){return s(e.target)});s(e.element)!==i&&T(function(){e.element.parentNode.removeChild(e.element),i.appendChild(e.element)}),d(o.offset,t.offset),u=!0}():(l.position="absolute",d({top:!0,left:!0},t.page)),!u){for(var p=!0,c=this.element.parentNode;c&&"BODY"!==c.tagName;){if("static"!==getComputedStyle(c).position){p=!1;break}c=c.parentNode}p||(this.element.parentNode.removeChild(this.element),document.body.appendChild(this.element))}var m={},v=!1;for(var n in l){var y=l[n],b=this.element.style[n];""!==b&&""!==y&&["top","left","bottom","right"].indexOf(n)>=0&&(b=parseFloat(b),y=parseFloat(y)),b!==y&&(v=!0,m[n]=y)}v&&T(function(){f(e.element.style,m)})}}}]),t}();N.modules=[],C.position=_;var R=f(N,C),M=function(){function t(t,e){var o=[],i=!0,n=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(o.push(s.value),!e||o.length!==e);i=!0);}catch(f){n=!0,r=f}finally{try{!i&&a["return"]&&a["return"]()}finally{if(n)throw r}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P=C.Utils,r=P.getBounds,f=P.extend,c=P.updateClasses,T=P.defer,U=["left","top","right","bottom"];C.modules.push({position:function(t){var e=this,o=t.top,i=t.left,n=t.targetAttachment;if(!this.options.constraints)return!0;var s=this.cache("element-bounds",function(){return r(e.element)}),a=s.height,h=s.width;if(0===h&&0===a&&"undefined"!=typeof this.lastSize){var l=this.lastSize;h=l.width,a=l.height}var d=this.cache("target-bounds",function(){return e.getTargetBounds()}),u=d.height,p=d.width,g=[this.getClass("pinned"),this.getClass("out-of-bounds")];this.options.constraints.forEach(function(t){var e=t.outOfBoundsClass,o=t.pinnedClass;e&&g.push(e),o&&g.push(o)}),g.forEach(function(t){["left","top","right","bottom"].forEach(function(e){g.push(t+"-"+e)})});var m=[],v=f({},n),y=f({},this.attachment);return this.options.constraints.forEach(function(t){var r=t.to,s=t.attachment,f=t.pin;"undefined"==typeof s&&(s="");var l=void 0,d=void 0;if(s.indexOf(" ")>=0){var c=s.split(" "),g=M(c,2);d=g[0],l=g[1]}else l=d=s;var w=b(e,r);("target"===d||"both"===d)&&(o<w[1]&&"top"===v.top&&(o+=u,v.top="bottom"),o+a>w[3]&&"bottom"===v.top&&(o-=u,v.top="top")),"together"===d&&(o<w[1]&&"top"===v.top&&("bottom"===y.top?(o+=u,v.top="bottom",o+=a,y.top="top"):"top"===y.top&&(o+=u,v.top="bottom",o-=a,y.top="bottom")),o+a>w[3]&&"bottom"===v.top&&("top"===y.top?(o-=u,v.top="top",o-=a,y.top="bottom"):"bottom"===y.top&&(o-=u,v.top="top",o+=a,y.top="top")),"middle"===v.top&&(o+a>w[3]&&"top"===y.top?(o-=a,y.top="bottom"):o<w[1]&&"bottom"===y.top&&(o+=a,y.top="top"))),("target"===l||"both"===l)&&(i<w[0]&&"left"===v.left&&(i+=p,v.left="right"),i+h>w[2]&&"right"===v.left&&(i-=p,v.left="left")),"together"===l&&(i<w[0]&&"left"===v.left?"right"===y.left?(i+=p,v.left="right",i+=h,y.left="left"):"left"===y.left&&(i+=p,v.left="right",i-=h,y.left="right"):i+h>w[2]&&"right"===v.left?"left"===y.left?(i-=p,v.left="left",i-=h,y.left="right"):"right"===y.left&&(i-=p,v.left="left",i+=h,y.left="left"):"center"===v.left&&(i+h>w[2]&&"left"===y.left?(i-=h,y.left="right"):i<w[0]&&"right"===y.left&&(i+=h,y.left="left"))),("element"===d||"both"===d)&&(o<w[1]&&"bottom"===y.top&&(o+=a,y.top="top"),o+a>w[3]&&"top"===y.top&&(o-=a,y.top="bottom")),("element"===l||"both"===l)&&(i<w[0]&&"right"===y.left&&(i+=h,y.left="left"),i+h>w[2]&&"left"===y.left&&(i-=h,y.left="right")),"string"==typeof f?f=f.split(",").map(function(t){return t.trim()}):f===!0&&(f=["top","left","right","bottom"]),f=f||[];var C=[],O=[];o<w[1]&&(f.indexOf("top")>=0?(o=w[1],C.push("top")):O.push("top")),o+a>w[3]&&(f.indexOf("bottom")>=0?(o=w[3]-a,C.push("bottom")):O.push("bottom")),i<w[0]&&(f.indexOf("left")>=0?(i=w[0],C.push("left")):O.push("left")),i+h>w[2]&&(f.indexOf("right")>=0?(i=w[2]-h,C.push("right")):O.push("right")),C.length&&!function(){var t=void 0;t="undefined"!=typeof e.options.pinnedClass?e.options.pinnedClass:e.getClass("pinned"),m.push(t),C.forEach(function(e){m.push(t+"-"+e)})}(),O.length&&!function(){var t=void 0;t="undefined"!=typeof e.options.outOfBoundsClass?e.options.outOfBoundsClass:e.getClass("out-of-bounds"),m.push(t),O.forEach(function(e){m.push(t+"-"+e)})}(),(C.indexOf("left")>=0||C.indexOf("right")>=0)&&(y.left=v.left=!1),(C.indexOf("top")>=0||C.indexOf("bottom")>=0)&&(y.top=v.top=!1),(v.top!==n.top||v.left!==n.left||y.top!==e.attachment.top||y.left!==e.attachment.left)&&e.updateAttachClasses(y,v)}),T(function(){e.options.addTargetClasses!==!1&&c(e.target,m,g),c(e.element,m,g)}),{top:o,left:i}}});var P=C.Utils,r=P.getBounds,c=P.updateClasses,T=P.defer;C.modules.push({position:function(t){var e=this,o=t.top,i=t.left,n=this.cache("element-bounds",function(){return r(e.element)}),s=n.height,a=n.width,f=this.getTargetBounds(),h=o+s,l=i+a,d=[];o<=f.bottom&&h>=f.top&&["left","right"].forEach(function(t){var e=f[t];(e===i||e===l)&&d.push(t)}),i<=f.right&&l>=f.left&&["top","bottom"].forEach(function(t){var e=f[t];(e===o||e===h)&&d.push(t)});var u=[],p=[],g=["left","top","right","bottom"];return u.push(this.getClass("abutted")),g.forEach(function(t){u.push(e.getClass("abutted")+"-"+t)}),d.length&&p.push(this.getClass("abutted")),d.forEach(function(t){p.push(e.getClass("abutted")+"-"+t)}),T(function(){e.options.addTargetClasses!==!1&&c(e.target,p,u),c(e.element,p,u)}),!0}});var M=function(){function t(t,e){var o=[],i=!0,n=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(o.push(s.value),!e||o.length!==e);i=!0);}catch(f){n=!0,r=f}finally{try{!i&&a["return"]&&a["return"]()}finally{if(n)throw r}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return C.modules.push({position:function(t){var e=t.top,o=t.left;if(this.options.shift){var i=this.options.shift;"function"==typeof this.options.shift&&(i=this.options.shift.call(this,{top:e,left:o}));var n=void 0,r=void 0;if("string"==typeof i){i=i.split(" "),i[1]=i[1]||i[0];var s=M(i,2);n=s[0],r=s[1],n=parseFloat(n,10),r=parseFloat(r,10)}else n=i.top,r=i.left;return e+=n,o+=r,{top:e,left:o}}}}),R});
}
// File:js/lib/colorpicker.min.js

if( typeof importScripts !== 'function' ){
(function(w,l,r){function s(a,d){var b=d.getBoundingClientRect();return{x:Math.max(Math.min(a.clientX-b.left,d.clientWidth),0),y:Math.max(Math.min(a.clientY-b.top,d.clientHeight),0)}}function f(a,d,b){a=l.createElementNS("http://www.w3.org/2000/svg",a);for(var c in d)a.setAttribute(c,d[c]);Array.isArray(b)||(b=[b]);d=0;for(c=b[0]&&b.length||0;d<c;d++)a.appendChild(b[d]);return a}function k(a){var d,b,c,e,h=a.h%360/60;e=a.v*a.s;c=e*(1-Math.abs(h%2-1));d=b=a=a.v-e;h=~~h;d+=[e,c,0,0,c,e][h];b+=[c,e,
e,c,0,0][h];a+=[0,0,c,e,e,c][h];c=Math.floor(255*d);b=Math.floor(255*b);a=Math.floor(255*a);return{r:c,g:b,b:a,hex:"#"+(16777216|a|b<<8|c<<16).toString(16).slice(1)}}function m(a){var d=a.r,b=a.g,c=a.b;if(1<a.r||1<a.g||1<a.b)d/=255,b/=255,c/=255;var e;a=Math.max(d,b,c);e=a-Math.min(d,b,c);d=(0==e?0:a==d?(b-c)/e+(b<c?6:0):a==b?(c-d)/e+2:(d-b)/e+4)%6*60;return{h:d,s:0==e?0:e/a,v:a}}function x(a,d,b){return function(c){c=s(c,d);a.h=c.y/d.offsetHeight*360;var e=k({h:a.h,s:1,v:1}),h=k({h:a.h,s:a.s,v:a.v});
b.style.backgroundColor=e.hex;a.callback&&a.callback(h.hex,{h:a.h,s:a.s,v:a.v},{r:h.r,g:h.g,b:h.b},r,c)}}function y(a,d){return function(b){b=s(b,d);var c=d.offsetHeight;a.s=b.x/d.offsetWidth;a.v=(c-b.y)/c;c=k(a);a.callback&&a.callback(c.hex,{h:a.h,s:a.s,v:a.v},{r:c.r,g:c.g,b:c.b},b)}}function g(a,d,b){if(!(this instanceof g))return new g(a,d,b);this.h=0;this.v=this.s=1;b?(this.callback=b,this.pickerElement=d,this.slideElement=a):(a.innerHTML='<div class="picker-wrapper"><div class="picker"></div><div class="picker-indicator"></div></div><div class="slide-wrapper"><div class="slide"></div><div class="slide-indicator"></div></div>',
this.slideElement=a.getElementsByClassName("slide")[0],this.pickerElement=a.getElementsByClassName("picker")[0],this.slideIndicator=a.getElementsByClassName("slide-indicator")[0],this.pickerIndicator=a.getElementsByClassName("picker-indicator")[0],g.positionIndicators(this.slideIndicator,this.pickerIndicator,{x:0,y:0},{x:0,y:0}),this.callback=function(a,b,c,e,f){g.positionIndicators(this.slideIndicator,this.pickerIndicator,f,e);d(a,b,c)});this.slide_listener=x(this,this.slideElement,this.pickerElement);
this.picker_listener=y(this,this.pickerElement);b||this.fixIndicators(this.slideIndicator,this.pickerIndicator);a=t.cloneNode(!0);b=u.cloneNode(!0);var c=a.getElementById("gradient-hsv"),e=a.getElementsByTagName("rect")[0];c.id="gradient-hsv-"+n;e.setAttribute("fill","url(#"+c.id+")");c=[b.getElementById("gradient-black"),b.getElementById("gradient-white")];e=b.getElementsByTagName("rect");c[0].id="gradient-black-"+n;c[1].id="gradient-white-"+n;e[0].setAttribute("fill","url(#"+c[1].id+")");e[1].setAttribute("fill",
"url(#"+c[0].id+")");this.slideElement.appendChild(a);this.pickerElement.appendChild(b);n++;p(this.slideElement,this.slide_listener);p(this.pickerElement,this.picker_listener)}function p(a,d){function b(a){e&&d(a)}function c(a){b(a);e=!1;l.removeEventListener("mouseup",c,!1);l.removeEventListener("mousemove",b,!1)}var e=!1;a.addEventListener("mousedown",function(a){e=!0;a.preventDefault();l.addEventListener("mouseup",c,!0);l.addEventListener("mousemove",b,!1)},!1)}function q(a,d,b,c){a.h=d.h%360;
a.s=d.s;a.v=d.v;d=k(a);var e={y:a.h*a.slideElement.offsetHeight/360,x:0},f=a.pickerElement.offsetHeight,f={x:a.s*a.pickerElement.offsetWidth,y:f-a.v*f};a.pickerElement.style.backgroundColor=k({h:a.h,s:1,v:1}).hex;a.callback&&a.callback(c||d.hex,{h:a.h,s:a.s,v:a.v},b||{r:d.r,g:d.g,b:d.b},f,e);return a}var u,t,v={xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"};t=f("svg",v,[f("defs",{},f("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[f("stop",{offset:"0%",
"stop-color":"#FF0000","stop-opacity":"1"}),f("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),f("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),f("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),f("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),f("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),f("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),f("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),
f("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),f("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]);u=f("svg",v,[f("defs",{},[f("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[f("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),f("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),f("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[f("stop",{offset:"0%","stop-color":"#FFFFFF",
"stop-opacity":"1"}),f("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),f("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),f("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})]);var n=0;g.hsv2rgb=function(a){a=k(a);delete a.hex;return a};g.hsv2hex=function(a){return k(a).hex};g.rgb2hsv=m;g.rgb2hex=function(a){return k(m(a)).hex};g.hex2hsv=function(a){return m(g.hex2rgb(a))};g.hex2rgb=function(a){return{r:parseInt(a.substr(1,
2),16),g:parseInt(a.substr(3,2),16),b:parseInt(a.substr(5,2),16)}};g.prototype.setHsv=function(a){return q(this,a)};g.prototype.setRgb=function(a){return q(this,m(a),a)};g.prototype.setHex=function(a){return q(this,g.hex2hsv(a),r,a)};g.positionIndicators=function(a,d,b,c){b&&(a.style.top=b.y-a.offsetHeight/2+"px");c&&(d.style.top=c.y-d.offsetHeight/2+"px",d.style.left=c.x-d.offsetWidth/2+"px")};g.prototype.fixIndicators=function(a,d){p(a,this.slide_listener);p(d,this.picker_listener)};w.ColorPicker=
g})(window,window.document);
}
// File:js/build/gui-no-libs.min.js

// https://github.com/arose/ngl/ LICENSE
var UI={Element:function(){}};
UI.Element.prototype={setId:function(a){this.dom.id=a;return this},setTitle:function(a){this.dom.title=a;return this},setClass:function(a){this.dom.className=a;return this},setStyle:function(a,b){for(var c=0;c<b.length;c++)this.dom.style[a]=b[c]},getStyle:function(a){return this.dom.style[a]},getBox:function(){return this.dom.getBoundingClientRect()},setDisabled:function(a){this.dom.disabled=a;return this},setTextContent:function(a){this.dom.textContent=a;return this},dispose:function(){this.dom.parentNode.removeChild(this.dom)}};
var properties="position left top right bottom width height border borderLeft borderTop borderRight borderBottom borderColor display overflow overflowX overflowY margin marginLeft marginTop marginRight marginBottom padding paddingLeft paddingTop paddingRight paddingBottom color backgroundColor opacity fontSize fontWeight fontStyle fontFamily textTransform cursor verticalAlign clear float zIndex minHeight maxHeight minWidth maxWidth wordBreak wordWrap spellcheck lineHeight whiteSpace textOverflow textAlign".split(" ");
properties.forEach(function(a){var b=a.substr(0,1).toUpperCase()+a.substr(1,a.length);UI.Element.prototype["set"+b]=function(){this.setStyle(a,arguments);return this};UI.Element.prototype["get"+b]=function(){return this.getStyle(a)}});var events="KeyUp KeyDown KeyPress MouseOver MouseOut MouseDown MouseUp Click Change Input Scroll".split(" ");events.forEach(function(a){UI.Element.prototype["on"+a]=function(b){this.dom.addEventListener(a.toLowerCase(),b.bind(this),!1);return this}});
UI.Panel=function(){UI.Element.call(this);var a=document.createElement("div");a.className="Panel";this.dom=a;return this};UI.Panel.prototype=Object.create(UI.Element.prototype);UI.Panel.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.dom.appendChild(arguments[a].dom);return this};UI.Panel.prototype.remove=function(){for(var a=0;a<arguments.length;a++)this.dom.removeChild(arguments[a].dom);return this};
UI.Panel.prototype.clear=function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild);return this};
UI.CollapsiblePanel=function(){UI.Panel.call(this);this.dom.className="Panel CollapsiblePanel";this.button=document.createElement("div");this.button.className="CollapsiblePanelButton";this.dom.appendChild(this.button);var a=this;this.button.addEventListener("click",function(b){a.toggle()},!1);this.content=document.createElement("div");this.content.className="CollapsibleContent";this.dom.appendChild(this.content);this.isCollapsed=!1;return this};UI.CollapsiblePanel.prototype=Object.create(UI.Panel.prototype);
UI.CollapsiblePanel.prototype.addStatic=function(){for(var a=0;a<arguments.length;a++)this.dom.insertBefore(arguments[a].dom,this.content);return this};UI.CollapsiblePanel.prototype.removeStatic=UI.Panel.prototype.remove;UI.CollapsiblePanel.prototype.clearStatic=function(){this.dom.childNodes.forEach(function(a){a!==this.content&&this.dom.removeChild(a)})};UI.CollapsiblePanel.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.content.appendChild(arguments[a].dom);return this};
UI.CollapsiblePanel.prototype.remove=function(){for(var a=0;a<arguments.length;a++)this.content.removeChild(arguments[a].dom);return this};UI.CollapsiblePanel.prototype.clear=function(){for(;this.content.children.length;)this.content.removeChild(this.content.lastChild)};UI.CollapsiblePanel.prototype.toggle=function(){this.setCollapsed(!this.isCollapsed)};UI.CollapsiblePanel.prototype.collapse=function(){this.setCollapsed(!0)};UI.CollapsiblePanel.prototype.expand=function(){this.setCollapsed(!1)};
UI.CollapsiblePanel.prototype.setCollapsed=function(a){a?this.dom.classList.add("collapsed"):this.dom.classList.remove("collapsed");this.isCollapsed=a};UI.Text=function(a){UI.Element.call(this);var b=document.createElement("span");b.className="Text";b.style.display="inline-block";b.style.verticalAlign="middle";this.dom=b;this.setValue(a);return this};UI.Text.prototype=Object.create(UI.Element.prototype);UI.Text.prototype.setValue=function(a){void 0!==a&&(this.dom.textContent=a);return this};
UI.Text.prototype.setName=function(a){this.dom.name=a;return this};UI.Input=function(){UI.Element.call(this);var a=document.createElement("input");a.className="Input";a.style.padding="2px";a.style.border="1px solid #ccc";a.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.dom=a;return this};UI.Input.prototype=Object.create(UI.Element.prototype);UI.Input.prototype.getValue=function(){return this.dom.value};UI.Input.prototype.setValue=function(a){this.dom.value=a;return this};
UI.Input.prototype.setName=function(a){this.dom.name=a;return this};UI.TextArea=function(){UI.Element.call(this);var a=document.createElement("textarea");a.className="TextArea";a.style.padding="2px";a.style.border="1px solid #ccc";a.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.dom=a;return this};UI.TextArea.prototype=Object.create(UI.Element.prototype);UI.TextArea.prototype.getValue=function(){return this.dom.value};
UI.TextArea.prototype.setValue=function(a){this.dom.value=a;return this};UI.Select=function(){UI.Element.call(this);var a=document.createElement("select");a.className="Select";a.style.width="64px";a.style.height="16px";a.style.border="0px";a.style.padding="0px";this.dom=a;return this};UI.Select.prototype=Object.create(UI.Element.prototype);UI.Select.prototype.setMultiple=function(a){this.dom.multiple=a;return this};
UI.Select.prototype.setOptions=function(a){for(var b=this.dom.value;0<this.dom.children.length;)this.dom.removeChild(this.dom.firstChild);for(var c in a){var d=document.createElement("option");d.value=c;d.innerHTML=a[c];this.dom.appendChild(d)}this.dom.value=b;return this};UI.Select.prototype.getValue=function(){return this.dom.value};UI.Select.prototype.setValue=function(a){this.dom.value=a;return this};UI.Select.prototype.setName=function(a){this.dom.name=a;return this};
UI.FancySelect=function(){UI.Element.call(this);var a=this,b=document.createElement("div");b.className="FancySelect";b.tabIndex=0;var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0);b.addEventListener("keydown",function(a){switch(a.keyCode){case 38:case 40:a.preventDefault(),a.stopPropagation()}},!1);b.addEventListener("keyup",function(b){switch(b.keyCode){case 38:case 40:a.selectedIndex+=38==b.keyCode?-1:1,0<=a.selectedIndex&&a.selectedIndex<a.options.length&&(a.setValue(a.options[a.selectedIndex].value),
a.dom.dispatchEvent(c))}},!1);this.dom=b;this.options=[];this.selectedIndex=-1;this.selectedValue=null;return this};UI.FancySelect.prototype=Object.create(UI.Element.prototype);
UI.FancySelect.prototype.setOptions=function(a){var b=this,c=document.createEvent("HTMLEvents");for(c.initEvent("change",!0,!0);0<b.dom.children.length;)b.dom.removeChild(b.dom.firstChild);b.options=[];for(var d=0;d<a.length;d++){var e=a[d],f=document.createElement("div");f.className="option";f.innerHTML=e.html;f.value=e.value;b.dom.appendChild(f);b.options.push(f);f.addEventListener("click",function(a){b.setValue(this.value);b.dom.dispatchEvent(c)},!1)}return b};
UI.FancySelect.prototype.getValue=function(){return this.selectedValue};UI.FancySelect.prototype.setValue=function(a){for(var b=0;b<this.options.length;b++){var c=this.options[b];if(c.value===a){c.classList.add("active");var d=c.offsetTop-this.dom.offsetTop,c=d+c.offsetHeight-this.dom.offsetHeight;this.dom.scrollTop>d?this.dom.scrollTop=d:this.dom.scrollTop<c&&(this.dom.scrollTop=c);this.selectedIndex=b}else c.classList.remove("active")}this.selectedValue=a;return this};
UI.Checkbox=function(a){UI.Element.call(this);var b=document.createElement("input");b.className="Checkbox";b.type="checkbox";this.dom=b;this.setValue(a);return this};UI.Checkbox.prototype=Object.create(UI.Element.prototype);UI.Checkbox.prototype.getValue=function(){return this.dom.checked};UI.Checkbox.prototype.setValue=function(a){void 0!==a&&(this.dom.checked=a);return this};UI.Checkbox.prototype.setName=function(a){this.dom.name=a;return this};
UI.Color=function(){UI.Element.call(this);var a=document.createElement("input");a.className="Color";a.style.width="64px";a.style.height="16px";a.style.border="0px";a.style.padding="0px";a.style.backgroundColor="transparent";try{a.type="color",a.value="#ffffff"}catch(b){}this.dom=a;return this};UI.Color.prototype=Object.create(UI.Element.prototype);UI.Color.prototype.getValue=function(){return this.dom.value};UI.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)};
UI.Color.prototype.setValue=function(a){this.dom.value=a;return this};UI.Color.prototype.setHexValue=function(a){this.dom.value="#"+("000000"+a.toString(16)).slice(-6);return this};
UI.Number=function(a){UI.Element.call(this);var b=this,c=document.createElement("input");c.className="Number";c.value="0.00";c.addEventListener("keydown",function(a){a.stopPropagation();13===a.keyCode&&c.blur()},!1);this.min=-Infinity;this.max=Infinity;this.precision=2;this.step=1;this.dom=c;this.setValue(a);var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!0);var e=0,f=0,g=[0,0],h=[0,0],l=function(a){var l=c.value;g=[a.clientX,a.clientY];e+=g[0]-h[0]-(g[1]-h[1]);var k=50;a.shiftKey&&
(k=5);a.ctrlKey&&(k=500);c.value=Math.min(b.max,Math.max(b.min,f+e/k*b.step)).toFixed(b.precision);l!==c.value&&c.dispatchEvent(d);h=[a.clientX,a.clientY]},k=function(a){document.removeEventListener("mousemove",l,!1);document.removeEventListener("mouseup",k,!1);2>Math.abs(e)&&(c.focus(),c.select())};c.addEventListener("mousedown",function(a){a.preventDefault();e=0;f=parseFloat(c.value);h=[a.clientX,a.clientY];document.addEventListener("mousemove",l,!1);document.addEventListener("mouseup",k,!1)},!1);
c.addEventListener("change",function(a){a=parseFloat(c.value);c.value=!1===isNaN(a)?a:0},!1);c.addEventListener("focus",function(a){c.style.backgroundColor="";c.style.borderColor="#ccc";c.style.cursor=""},!1);c.addEventListener("blur",function(a){c.style.backgroundColor="transparent";c.style.borderColor="transparent";c.style.cursor="col-resize"},!1);return this};UI.Number.prototype=Object.create(UI.Element.prototype);UI.Number.prototype.getValue=function(){return parseFloat(this.dom.value)};
UI.Number.prototype.setValue=function(a){isNaN(a)?this.dom.value=NaN:void 0!==a&&(this.dom.value=a.toFixed(this.precision));return this};UI.Number.prototype.setRange=function(a,b){this.min=a;this.max=b;return this};UI.Number.prototype.setPrecision=function(a){this.precision=a;return this};UI.Number.prototype.setName=function(a){this.dom.name=a;return this};
UI.Integer=function(a){UI.Element.call(this);var b=this,c=document.createElement("input");c.className="Number";c.value="0.00";c.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.min=-Infinity;this.max=Infinity;this.step=1;this.dom=c;this.setValue(a);var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!0);var e=0,f=0,g=[0,0],h=[0,0],l=function(a){var l=c.value;g=[a.clientX,a.clientY];e+=g[0]-h[0]-(g[1]-h[1]);var k=50;a.shiftKey&&(k=5);a.ctrlKey&&(k=500);c.value=Math.min(b.max,
Math.max(b.min,f+e/k*b.step))|0;l!==c.value&&c.dispatchEvent(d);h=[a.clientX,a.clientY]},k=function(a){document.removeEventListener("mousemove",l,!1);document.removeEventListener("mouseup",k,!1);2>Math.abs(e)&&(c.focus(),c.select())};c.addEventListener("mousedown",function(a){a.preventDefault();e=0;f=parseFloat(c.value);h=[a.clientX,a.clientY];document.addEventListener("mousemove",l,!1);document.addEventListener("mouseup",k,!1)},!1);c.addEventListener("change",function(a){a=parseInt(c.value);!1===
isNaN(a)&&(c.value=a)},!1);c.addEventListener("focus",function(a){c.style.backgroundColor="";c.style.borderColor="#ccc";c.style.cursor=""},!1);c.addEventListener("blur",function(a){c.style.backgroundColor="transparent";c.style.borderColor="transparent";c.style.cursor="col-resize"},!1);return this};UI.Integer.prototype=Object.create(UI.Element.prototype);UI.Integer.prototype.getValue=function(){return parseInt(this.dom.value)};
UI.Integer.prototype.setValue=function(a){void 0!==a&&(this.dom.value=a|0);return this};UI.Integer.prototype.setRange=function(a,b){this.min=a;this.max=b;return this};UI.Integer.prototype.setName=function(a){this.dom.name=a;return this};UI.Integer.prototype.setStep=function(a){this.step=a;return this};UI.Break=function(){UI.Element.call(this);var a=document.createElement("br");a.className="Break";this.dom=a;return this};UI.Break.prototype=Object.create(UI.Element.prototype);
UI.HorizontalRule=function(){UI.Element.call(this);var a=document.createElement("hr");a.className="HorizontalRule";this.dom=a;return this};UI.HorizontalRule.prototype=Object.create(UI.Element.prototype);UI.Button=function(a){UI.Element.call(this);var b=document.createElement("button");b.className="Button";this.dom=b;this.dom.textContent=a;return this};UI.Button.prototype=Object.create(UI.Element.prototype);UI.Button.prototype.setLabel=function(a){this.dom.textContent=a;return this};
UI.MenubarHelper={createMenuContainer:function(a,b){var c=new UI.Panel,d=new UI.Panel;d.setClass("title");d.setTextContent(a);d.setMargin("0px");d.setPadding("8px");c.setClass("menu");c.add(d);c.add(b);return c},createOption:function(a,b,c){var d=new UI.Panel;d.setClass("option");c?(d.add((new UI.Icon(c)).setWidth("20px")),d.add(new UI.Text(a))):d.setTextContent(a);d.onClick(b);return d},createOptionsPanel:function(a){var b=new UI.Panel;b.setClass("options");a.forEach(function(a){b.add(a)});return b},
createInput:function(a,b){var c=(new UI.Panel).setClass("option"),d=(new UI.Text).setWidth("70px").setValue(a),e=(new UI.Input).setWidth("40px").onKeyDown(b);c.add(d);c.add(e);return c},createCheckbox:function(a,b,c){var d=(new UI.Panel).setClass("option");a=(new UI.Text).setWidth("70px").setValue(a);b=(new UI.Checkbox).setValue(b).onClick(c);d.add(b);d.add(a);return d},createDivider:function(){return new UI.HorizontalRule}};
UI.Html=function(a){UI.Element.call(this);var b=document.createElement("span");b.className="Html";b.style.cursor="default";b.style.display="inline-block";b.style.verticalAlign="middle";this.dom=b;this.setValue(a);return this};UI.Html.prototype=Object.create(UI.Element.prototype);UI.Html.prototype.setValue=function(a){void 0!==a&&(this.dom.innerHTML=a);return this};
UI.Form=function(){UI.Element.call(this);var a=document.createElement("form");a.className="Form";a.method="post";a.action="";a.target="_blank";a.enctype="multipart/form-data";this.dom=a;return this};UI.Form.prototype=Object.create(UI.Panel.prototype);UI.Form.prototype.setMethod=function(a){this.dom.method=a;return this};UI.Form.prototype.setAction=function(a){this.dom.action=a;return this};UI.Form.prototype.setTarget=function(a){this.dom.target=a;return this};
UI.Form.prototype.setEnctype=function(a){this.dom.enctype=a;return this};UI.File=function(){UI.Input.call(this);this.dom.className="File";this.dom.type="file";this.dom.multiple=!1;return this};UI.File.prototype=Object.create(UI.Input.prototype);UI.File.prototype.setMultiple=function(a){this.dom.multiple=a;return this};UI.File.prototype.getFiles=function(a){return this.dom.files};UI.Hidden=function(){UI.Input.call(this);this.dom.type="hidden";return this};UI.Hidden.prototype=Object.create(UI.Input.prototype);
UI.ToggleButton=function(a,b,c,d){UI.Button.call(this,b);var e=!0;this.onClick(function(){e?(e=!1,this.setLabel(a),d()):(e=!0,this.setLabel(b),c())}.bind(this));return this};UI.ToggleButton.prototype=Object.create(UI.Button.prototype);UI.EllipsisText=function(a){UI.Text.call(this,a);this.setWhiteSpace("nowrap");this.setOverflow("hidden");this.setTextOverflow("ellipsis");return this};UI.EllipsisText.prototype=Object.create(UI.Text.prototype);
UI.EllipsisText.prototype.setValue=function(a){void 0!==a&&(this.dom.textContent=a,this.setTitle(a));return this};UI.EllipsisMultilineText=function(a){UI.Element.call(this);var b=document.createElement("span");b.className="EllipsisMultilineText";b.style.cursor="default";b.style.display="inline-block";b.style.verticalAlign="middle";var c=document.createElement("p");b.appendChild(c);this.dom=b;this.content=c;this.setValue(a);return this};UI.EllipsisMultilineText.prototype=Object.create(UI.Element.prototype);
UI.EllipsisMultilineText.prototype.setValue=function(a){void 0!==a&&(this.content.textContent=a,this.setTitle(a));return this};UI.OverlayPanel=function(){UI.Panel.call(this);this.dom.className="Panel OverlayPanel";this.dom.tabIndex=0;return this};UI.OverlayPanel.prototype=Object.create(UI.Panel.prototype);UI.OverlayPanel.prototype.attach=function(a){a=a||document.body;a.appendChild(this.dom);return this};
UI.Icon=function(a){UI.Panel.call(this);var b=document.createElement("span");b.className="Icon fa";this.dom=b;a&&this.addClass.apply(this,arguments);return this};UI.Icon.prototype=Object.create(UI.Panel.prototype);UI.Icon.prototype.hasClass=function(a){return this.dom.classList.contains("fa-"+a)};UI.Icon.prototype.addClass=function(a){for(var b=0;b<arguments.length;b++)this.dom.classList.add("fa-"+arguments[b]);return this};
UI.Icon.prototype.setClass=function(a){this.dom.className="Icon fa";for(var b=0;b<arguments.length;b++)this.dom.classList.add("fa-"+arguments[b]);return this};UI.Icon.prototype.removeClass=function(a){for(var b=0;b<arguments.length;b++)this.dom.classList.remove("fa-"+arguments[b]);return this};UI.Icon.prototype.switchClass=function(a,b){this.removeClass(b,a);this.addClass(a);return this};UI.ToggleIcon=function(a,b,c){UI.Icon.call(this,a?b:c);this.value=a;this.classTrue=b;this.classFalse=c;return this};
UI.ToggleIcon.prototype=Object.create(UI.Icon.prototype);UI.ToggleIcon.prototype.setValue=function(a){(this.value=a)?this.switchClass(this.classTrue,this.classFalse):this.switchClass(this.classFalse,this.classTrue);return this};UI.ToggleIcon.prototype.getValue=function(){return this.value};
UI.DisposeIcon=function(){UI.Icon.call(this,"trash-o");var a=!1,b=this;this.setTitle("delete");this.setCursor("pointer");this.onClick(function(){!0===a?"function"===typeof b.disposeFunction&&b.disposeFunction():(b.setColor("rgb(178, 34, 34)"),b.dom.classList.add("deleteInfo"),a=!0,setTimeout(function(){b.setColor("#888");b.dom.classList.remove("deleteInfo");a=!1},1500))});return this};UI.DisposeIcon.prototype=Object.create(UI.Icon.prototype);
UI.DisposeIcon.prototype.setDisposeFunction=function(a){this.disposeFunction=a;return this};UI.Progress=function(a,b){UI.Element.call(this);var c=document.createElement("progress");c.className="Progress";c.max=a||1;void 0!==b&&(c.value=b);this.dom=c;return this};UI.Progress.prototype=Object.create(UI.Element.prototype);UI.Progress.prototype.getValue=function(){return this.dom.value};UI.Progress.prototype.setValue=function(a){this.dom.value=a;return this};
UI.Progress.prototype.setMax=function(a){this.dom.max=a;return this};UI.Progress.prototype.setIndeterminate=function(){this.dom.removeAttribute("value");return this};UI.Range=function(a,b,c,d){UI.Element.call(this);var e=document.createElement("input");e.className="Range";e.type="range";e.min=a;e.max=b;e.value=c;e.step=d;this.dom=e;this.dom.textContent=c;this.onInput(function(){this.dom.setAttribute("value",this.getValue())});return this};UI.Range.prototype=Object.create(UI.Element.prototype);
UI.Range.prototype.getValue=function(){return this.dom.value};UI.Range.prototype.setRange=function(a,b){this.dom.min=a;this.dom.max=b;return this};UI.Range.prototype.setValue=function(a){this.dom.value=a;return this};UI.Range.prototype.setStep=function(a){this.dom.step=a;return this};
UI.AdaptiveTextArea=function(){UI.Element.call(this);var a=document.createElement("div");a.className="AdaptiveTextAreaContainer";var b=document.createElement("textarea");b.className="AdaptiveTextArea";var c=document.createElement("div");c.className="AdaptiveTextAreaSize";a.appendChild(b);a.appendChild(c);b.addEventListener("input",function(a){c.innerHTML=b.value+"\n"},!1);this.textarea=b;this.size=c;this.dom=a;return this};UI.AdaptiveTextArea.prototype=Object.create(UI.Element.prototype);
UI.AdaptiveTextArea.prototype.getValue=function(){return this.textarea.value};UI.AdaptiveTextArea.prototype.setValue=function(a){this.textarea.value=a;this.size.innerHTML=a+"\n";return this};UI.AdaptiveTextArea.prototype.setSpellcheck=function(a){this.textarea.spellcheck=a;return this};UI.AdaptiveTextArea.prototype.setBackgroundColor=function(a){this.textarea.style.backgroundColor=a;return this};
UI.VirtualList=function(a,b,c,d){function e(a){var c=d(a);c.classList.add("VirtualListRow");c.style.height=b+"px";c.style.top=a*b+"px";return c}function f(a){var b=Math.min(h,a+k);q(a,b);for(var c=document.createDocumentFragment();a<b;a++)c.appendChild(e(a));b=1;for(a=p.childNodes.length;b<a;b++)p.childNodes[b].style.display="none",p.childNodes[b].setAttribute("data-rm","1");p.appendChild(c)}UI.Element.call(this);a=a||[];b=b||20;c=c||300;d=d||function(){};var g=document.createElement("div");g.className=
"VirtualList";g.style.height=c+"px";var h=a.length,l=Math.ceil(c/b),k=3*l,m,r=l*b,t=0,q=function(){},p=document.createElement("div");p.style.width="100%";p.style.height=c+"px";p.style["overflow-y"]="auto";p.style.position="relative";p.style.padding=0;var n=document.createElement("div");n.style.opacity=0;n.style.position="absolute";n.style.top=0;n.style.left=0;n.style.width="1px";n.style.height=b*h+"px";var s=setInterval(function(){for(var a=g;a!==document&&a.parentNode;)a=a.parentNode;a!==document&&
clearInterval(s);if(100<Date.now()-t)for(var a=p.querySelectorAll('[data-rm="1"]'),b=0,c=a.length;b<c;b++)p.removeChild(a[b])},500);this.setItems=function(c){a=c;h=a.length;n.style.height=b*h+"px";f(0);return this};this.setItemHeight=function(a){b=a;l=Math.ceil(c/b);k=3*l;r=l*b;n.style.height=b*h+"px";f(0);return this};this.setHeight=function(a){UI.Element.prototype.setHeight.call(this,a+"px");c=a;l=Math.ceil(c/b);k=3*l;r=l*b;p.style.height=c+"px";n.style.height=c+"px";f(0);return this};this.setGeneratorFn=
function(a){d=a;f(0);return this};this.setRenderChunkCallback=function(a){q=a};this.redraw=function(){f(Math.max(0,Math.floor(p.scrollTop/b)-l));m=p.scrollTop;return this};p.appendChild(n);g.appendChild(p);p.addEventListener("scroll",function(a){var c=a.target.scrollTop;if(!m||Math.abs(c-m)>r)f(Math.max(0,Math.floor(c/b)-l)),m=c;t=Date.now();a.preventDefault&&a.preventDefault()});f(0);this.dom=g;return this};UI.VirtualList.prototype=Object.create(UI.Element.prototype);
UI.VirtualTable=function(a,b,c,d,e){e=e||{};UI.Panel.call(this);var f=void 0!==e.defaultWidth?e.defaultWidth:30,g=void 0!==e.defaultMargin?e.defaultMargin:5,h=void 0!==e.defaultAlign?e.defaultAlign:"left",l=e.onRowSelect,k=(new UI.Panel).setWhiteSpace("nowrap").setDisplay("inline-block").setOverflow("").setWidth("100%"),m=0,r=[],t=function(a,b){return a-b},q=function(a,b){return a.localeCompare(b)},p=function(b,c){var d;d="string"===typeof a[0][b]?q:t;a.sort(function(a,e){return c?d(e[b],a[b]):d(a[b],
e[b])});s.redraw();return this},n=function(b,c){r.length=0;l&&l(b,c);void 0!==c&&r.push(a[c][0]);s.redraw();return this};d.forEach(function(a){var b=a.width||f,c=a.margin||g,d=(new UI.EllipsisText).setValue(a.name).setWidth(b+"px").setTextAlign(a.align||h).setMarginLeft(c+"px").setMarginRight(c+"px").setCursor("pointer").onClick(function(b){b="ASC"===a.__sortFlag;p(a.index,b);a.__sortFlag=b?"DESC":"ASC"});k.add(d);m+=b+2*c});var s=(new UI.VirtualList(a,b,c,function(b){var c=new UI.Panel;d.forEach(function(d){var e=
a[b][d.index];d.format&&(e=d.format(e));var k=d.width||f,l=d.margin||g,m;m="object"===typeof e?e:(new UI.Text).setValue(e);m.setWidth(k+"px").setTextAlign(d.align||h).setMarginLeft(l+"px").setMarginRight(l+"px").onClick(function(a){if("function"===typeof d.onClick)d.onClick(a,b,e)}).onMouseOver(function(a){if("function"===typeof d.onMouseOver)d.onMouseOver(a,b,e)}).onMouseOut(function(a){if("function"===typeof d.onMouseOut)d.onMouseOut(a,b,e)});c.add(m)});c.setCursor("pointer").onClick(function(a){n(a,
b)});-1!==r.indexOf(a[b][0])&&c.dom.classList.add("highlight");return c.dom})).setWidth(m+20+"px");this.add(k,s);this.header=k;this.list=s;this.sortColumn=p;this.selectRow=function(a){n(void 0,a)};return this};UI.VirtualTable.prototype=Object.create(UI.Panel.prototype);
UI.PopupMenu=function(a,b,c){c=c||"scrollParent";UI.Panel.call(this);var d=new UI.Icon(a||"bars"),e=(new UI.OverlayPanel).setDisplay("none").attach(this.dom);a=(new UI.Panel).setBorderBottom("1px solid #555").setMarginBottom("10px").setHeight("25px");a.add((new UI.Icon("times")).setFloat("right").setCursor("pointer").onClick(function(){this.setMenuDisplay("none")}.bind(this))).add(new UI.Text(b));e.add(a);var f;d.setTitle("menu");d.setCursor("pointer");d.onClick(function(a){"block"===e.getDisplay()?
(this.setMenuDisplay("none"),f.destroy()):(this.setMenuDisplay("block"),f=new Tether({element:e.dom,target:d.dom,attachment:"top right",targetAttachment:"top left",offset:"0px 5px",constraints:[{to:c,attachment:"element",pin:["top","bottom"]}]}),f.position())}.bind(this));this.add(d);this.setClass("").setDisplay("inline");this.icon=d;this.panel=e;this.entryLabelWidth="100px";return this};UI.PopupMenu.prototype=Object.create(UI.Panel.prototype);
UI.PopupMenu.prototype.addEntry=function(a,b){this.panel.add((new UI.Text(a)).setWidth(this.entryLabelWidth)).add(b||new UI.Panel).add(new UI.Break);return this};UI.PopupMenu.prototype.setEntryLabelWidth=function(a){this.entryLabelWidth=a;return this};UI.PopupMenu.prototype.setMenuDisplay=function(a){this.panel.setDisplay(a);"none"!==a&&this.panel.dom.focus();return this};UI.PopupMenu.prototype.setIconTitle=function(a){this.icon.setTitle(a);return this};
UI.PopupMenu.prototype.dispose=function(){this.panel.dispose();UI.Element.prototype.dispose.call(this)};
UI.CollapsibleIconPanel=function(a,b){UI.Panel.call(this);this.dom.className="Panel CollapsiblePanel";void 0===a&&(a=a||"chevron-down",b=b||"chevron-right");this.button=(new UI.Icon(a)).setTitle("expand/collapse").setCursor("pointer").setWidth("12px").setMarginRight("6px");this.addStatic(this.button);var c=this;this.button.dom.addEventListener("click",function(a){c.toggle()},!1);this.content=document.createElement("div");this.content.className="CollapsibleContent";this.dom.appendChild(this.content);
this.isCollapsed=!1;this.iconClass1=a;this.iconClass2=b;return this};UI.CollapsibleIconPanel.prototype=Object.create(UI.CollapsiblePanel.prototype);
UI.CollapsibleIconPanel.prototype.setCollapsed=function(a){a?(this.dom.classList.add("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass2,this.iconClass1):this.button.addClass("rotate-90")):(this.dom.classList.remove("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass1,this.iconClass2):this.button.removeClass("rotate-90"));this.isCollapsed=a};
UI.ColorPicker=function(){var a=this;UI.Panel.call(this);this.slideWrapper=(new UI.Panel).setClass("slide-wrapper");this.sliderIndicator=(new UI.Panel).setClass("slide-indicator");this.slider=(new UI.Panel).setClass("slide").setWidth("25px").setHeight("80px");this.slideWrapper.add(this.slider,this.sliderIndicator);this.pickerWrapper=(new UI.Panel).setClass("picker-wrapper");this.pickerIndicator=(new UI.Panel).setClass("picker-indicator");this.picker=(new UI.Panel).setClass("picker").setWidth("130px").setHeight("80px");
this.pickerWrapper.add(this.picker,this.pickerIndicator);var b=document.createEvent("Event");b.initEvent("change",!0,!0);this.add(this.pickerWrapper,this.slideWrapper);this.colorPicker=ColorPicker(this.slider.dom,this.picker.dom,function(c,d,e,f,g){!f&&g&&.05>d.s?(d.s=.5,d.v=.7,a.colorPicker.setHsv(d)):(ColorPicker.positionIndicators(a.sliderIndicator.dom,a.pickerIndicator.dom,g,f),a.hex=c,a.hsv=d,a.rgb=e,a._settingValue||a.dom.dispatchEvent(b))});this.colorPicker.fixIndicators(this.sliderIndicator.dom,
this.pickerIndicator.dom);return this};UI.ColorPicker.prototype=Object.create(UI.Panel.prototype);UI.ColorPicker.prototype.setValue=function(a){a!==this.hex&&(this._settingValue=!0,this.colorPicker.setHex(a),this._settingValue=!1);return this};UI.ColorPicker.prototype.getValue=function(){return this.hex};
UI.ColorPopupMenu=function(){var a=this;UI.Panel.call(this);this.iconText=(new UI.Text("")).setCursor("pointer").setClass("fa-stack-1x").setFontFamily("Arial, sans-serif").setColor("#111");this.iconSquare=new UI.Icon("square","stack-1x");this.menu=new UI.PopupMenu("stack","Color");this.menu.icon.setTitle("color").setWidth("1em").setHeight("1em").setLineHeight("1em").add(this.iconSquare).add(this.iconText);var b=document.createEvent("Event");b.initEvent("change",!0,!0);this.colorInput=(new UI.Input).onChange(function(){a.setColor(a.colorInput.getValue());
a.dom.dispatchEvent(b)});this.colorPicker=(new UI.ColorPicker).setDisplay("inline-block").onChange(function(c){a.setColor(a.colorPicker.getValue());a.dom.dispatchEvent(b)});this.menu.addEntry("Input",this.colorInput).addEntry("Picker",this.colorPicker);this.add(this.menu);this.setClass("").setDisplay("inline");return this};UI.ColorPopupMenu.prototype=Object.create(UI.Panel.prototype);
UI.ColorPopupMenu.prototype.setColor=function(){var a=new THREE.Color;return function(b){a.set(b);b="#"+a.getHexString();this.colorInput.setBackgroundColor(b).setValue(b);this.colorPicker.setValue(b);this.iconSquare.setColor(b);130<Math.sqrt(255*a.r*a.r*61.455+255*a.g*a.g*255*.691+255*a.b*a.b*17.34)?(this.iconText.setColor("#000000"),this.colorInput.setColor("#000000")):(this.iconText.setColor("#FFFFFF"),this.colorInput.setColor("#FFFFFF"));return this}}();UI.ColorPopupMenu.prototype.getColor=function(){return this.colorInput.getValue()};
UI.ColorPopupMenu.prototype.getValue=function(){return this.getColor()};UI.ColorPopupMenu.prototype.setValue=function(a){this.setColor(a);return this};UI.ColorPopupMenu.prototype.dispose=function(){this.menu.dispose();UI.Panel.prototype.dispose.call(this)};
UI.SelectionInput=function(a){UI.AdaptiveTextArea.call(this);this.setSpellcheck(!1);if(!(a instanceof NGL.Selection))return NGL.error("UI.SelectionInput: not a selection",a),this;this.setValue(a.string);this.selection=a;var b=this;a.signals.stringChanged.add(function(a){b.setValue(a)});this.onEnter();return this};UI.SelectionInput.prototype=Object.create(UI.AdaptiveTextArea.prototype);UI.SelectionInput.prototype.setValue=function(a){UI.AdaptiveTextArea.prototype.setValue.call(this,a);return this};
UI.SelectionInput.prototype.onEnter=function(a){var b=this;this.onKeyPress(function(c){var d=b.getValue(),e=String.fromCharCode(c.which);13===c.keyCode?(c.preventDefault(),(new NGL.Selection(d)).selection.error?b.setBackgroundColor("tomato"):("function"===typeof a?a(d):b.selection.setString(d),b.setBackgroundColor("white"))):b.selection.string!==d+e?b.setBackgroundColor("skyblue"):b.setBackgroundColor("white")});this.onKeyUp(function(a){a=b.getValue();(new NGL.Selection(a)).selection.error?b.setBackgroundColor("tomato"):
b.selection.string===b.getValue()?b.setBackgroundColor("white"):b.setBackgroundColor("skyblue")});return this};UI.SelectionPanel=function(a){UI.Panel.call(this);this.icon=(new UI.Icon("filter")).setTitle("filter selection").addClass("lg").setMarginRight("10px");this.input=new UI.SelectionInput(a);this.add(this.icon,this.input);return this};UI.SelectionPanel.prototype=Object.create(UI.Panel.prototype);UI.SelectionPanel.prototype.setInputWidth=function(a){this.input.setWidth(a);return this};
UI.ComponentPanel=function(a){UI.Panel.call(this);var b=a.stage,c=a.signals;c.nameChanged.add(function(a){d.setValue(NGL.unicodeHelper(a))});c.visibilityChanged.add(function(a){e.setValue(a)});c.disposed.add(function(){g.dispose()});var d=(new UI.EllipsisText(NGL.unicodeHelper(a.name))).setWidth("100px"),e=(new UI.ToggleIcon(a.visible,"eye","eye-slash")).setTitle("hide/show").setCursor("pointer").setMarginLeft("25px").onClick(function(){a.setVisibility(!a.visible)}),c=(new UI.Icon("bullseye")).setTitle("center").setCursor("pointer").setMarginLeft("10px").onClick(function(){a.centerView(!0)}),
f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)}),g=(new UI.PopupMenu("bars",a.type)).setMarginLeft("46px").setEntryLabelWidth("110px");this.add(d,e,c,f,g);this.menu=g;return this};UI.ComponentPanel.prototype=Object.create(UI.Panel.prototype);UI.ComponentPanel.prototype.addMenuEntry=function(a,b){this.menu.addEntry(a,b);return this};UI.ComponentPanel.prototype.setMenuDisplay=function(a){this.menu.setMenuDisplay(a);return this};NGL.Widget=function(){};
NGL.Widget.prototype={constructor:NGL.Widget};
NGL.StageWidget=function(a){var b=a.signals,c=(new NGL.ViewportWidget(a)).setId("viewport");document.body.appendChild(c.dom);var d=(new NGL.ToolbarWidget(a)).setId("toolbar");document.body.appendChild(d.dom);var e=(new NGL.MenubarWidget(a)).setId("menubar");document.body.appendChild(e.dom);var f=(new NGL.SidebarWidget(a)).setId("sidebar");document.body.appendChild(f.dom);b.requestTheme.add(function(a){a="light"===a?NGL.cssDirectory+"light.css":NGL.cssDirectory+"dark.css";document.getElementById("theme").href=
a});a.preferences.setTheme();a.handleResize();setTimeout(function(){a.handleResize()},500);var g=!1,h=!1,l=!1,k=function(b){50<=b&&b<=window.innerWidth-10&&(f.setWidth(window.innerWidth-b+"px"),c.setWidth(b+"px"),d.setWidth(b+"px"),a.handleResize());var e=f.dom.getBoundingClientRect().width;void 0===b&&(b=window.innerWidth-e,c.setWidth(b+"px"),d.setWidth(b+"px"),a.handleResize());l=10>=e?!0:!1},k=NGL.throttle(k,50,{leading:!0,trailing:!0}),b=(new UI.Panel).setClass("ResizeLeft").onMouseDown(function(){g=
!0;h=!1}).onClick(function(){l?k(window.innerWidth-300):g||h||k(window.innerWidth-10)});f.add(b);window.addEventListener("mousemove",function(a){g&&(document.body.style.cursor="col-resize",h=!0,k(a.clientX))},!1);window.addEventListener("mouseup",function(a){g=!1;document.body.style.cursor=""},!1);window.addEventListener("resize",function(a){k()},!1);document.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="none"},!1);document.addEventListener("drop",
function(a){a.stopPropagation();a.preventDefault()},!1);this.viewport=c;this.toolbar=d;this.menubar=e;this.sidebar=f;return this};
NGL.ViewportWidget=function(a){var b=a.viewer,c=b.renderer,d=new UI.Panel;d.setPosition("absolute");b.container=d.dom;d.dom.appendChild(c.domElement);d.dom.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"},!1);d.dom.addEventListener("drop",function(b){b.stopPropagation();b.preventDefault();async.eachLimit(b.dataTransfer.files,4,function(b,c){a.loadFile(b,{defaultRepresentation:!0}).then(function(){c()})})},!1);return d};
NGL.ToolbarWidget=function(a){var b=a.signals,c=new UI.Panel,d=(new UI.Panel).setDisplay("inline").setFloat("left"),e=(new UI.Panel).setDisplay("inline").setFloat("right");b.onPicking.add(function(a){a=a.atom?"Picked atom: "+a.atom.qualifiedName()+" ("+a.atom.residue.chain.model.structure.name+")":a.bond?"Picked bond: "+a.bond.atom1.qualifiedName()+" - "+a.bond.atom2.qualifiedName()+" ("+a.bond.atom1.residue.chain.model.structure.name+")":a.volume?"Picked volume: "+a.volume.value.toPrecision(3)+" ("+
a.volume.volume.name+")":"Nothing to pick";d.clear().add(new UI.Text(a))});a.viewer.stats.signals.updated.add(function(){e.clear().add(new UI.Text(a.viewer.stats.lastDuration+" ms | "+a.viewer.stats.lastFps+" fps"))});c.add(d);return c};
NGL.MenubarWidget=function(a){var b=new UI.Panel;b.add(new NGL.MenubarFileWidget(a));b.add(new NGL.MenubarViewWidget(a));0<NGL.ExampleRegistry.count&&b.add(new NGL.MenubarExamplesWidget(a));0<NGL.PluginRegistry.count&&b.add(new NGL.MenubarPluginsWidget(a));b.add(new NGL.MenubarHelpWidget(a));b.add((new UI.Panel).setClass("menu").setFloat("right").add((new UI.Text("NGL Viewer "+NGL.REVISION)).setClass("title")));return b};
NGL.MenubarFileWidget=function(a){function b(){var b=NGL.DatasourceRegistry.listing,c;c=new NGL.DirectoryListingWidget(b,a,"Import file",d,function(e){var f=e.path.split(".").pop().toLowerCase();-1!==d.indexOf(f)?(a.loadFile(b.getUrl(e.path),{defaultRepresentation:!0}),c.dispose()):NGL.log("unknown filetype: "+f)});c.setOpacity("0.9").setLeft("50px").setTop("80px").attach()}var c="pdb ent pqr gro cif mcif mmcif sdf mol2 mrc ccp4 map cube dx obj ply ngl gz lzma bz2 zip".split(" "),d=c,e=document.createElement("input");
e.type="file";e.multiple=!0;e.style.display="none";e.accept="."+c.join(",.");e.addEventListener("change",function(b){async.eachLimit(b.target.files,4,function(b,c){a.loadFile(b,{defaultRepresentation:!0}).then(function(){c()})})},!1);var f=(new NGL.ExportImageWidget(a)).setDisplay("none").attach(),c=UI.MenubarHelper.createOption,g=UI.MenubarHelper.createInput,h=UI.MenubarHelper.createCheckbox,l=UI.MenubarHelper.createDivider,g=[c("Open...",function(){e.click()}),g("PDB",function(b){13===b.keyCode&&
(a.loadFile("rcsb://"+b.target.value,{defaultRepresentation:!0}),b.target.value="")}),h("asTrajectory",!1,function(b){a.defaultFileParams.asTrajectory=b.target.checked}),h("firstModelOnly",!1,function(b){a.defaultFileParams.firstModelOnly=b.target.checked}),h("cAlphaOnly",!1,function(b){a.defaultFileParams.cAlphaOnly=b.target.checked}),h("reorderAtoms",!1,function(b){a.defaultFileParams.reorderAtoms=b.target.checked}),l(),c("Screenshot",function(){a.viewer.screenshot({factor:1,type:"image/png",quality:1,
antialias:!0,transparent:!1,trim:!1})},"camera"),c("Export image...",function(){f.setOpacity("0.9").setLeft("50px").setTop("80px").setDisplay("block")})];NGL.DatasourceRegistry.listing&&g.splice(1,0,c("Import...",b));c=UI.MenubarHelper.createOptionsPanel(g);c.dom.appendChild(e);return UI.MenubarHelper.createMenuContainer("File",c)};
NGL.MenubarViewWidget=function(a){var b=UI.MenubarHelper.createOption,c=UI.MenubarHelper.createDivider,b=[b("Light theme",function(){var b=NGL.cssDirectory+"light.css";document.getElementById("theme").href=b;a.viewer.setBackground("white")}),b("Dark theme",function(){var b=NGL.cssDirectory+"dark.css";document.getElementById("theme").href=b;a.viewer.setBackground("black")}),c(),b("Full screen",function(){var a=document.body;a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():
a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()},"expand"),b("Center",function(){a.centerView()},"bullseye"),c(),b("Orientation",function(){window.prompt("Orientation",JSON.stringify(a.viewer.getOrientation()))})],b=UI.MenubarHelper.createOptionsPanel(b);return UI.MenubarHelper.createMenuContainer("View",b)};
NGL.MenubarExamplesWidget=function(a){var b=UI.MenubarHelper.createOption,c=UI.MenubarHelper.createDivider,d=[];NGL.ExampleRegistry.names.sort().forEach(function(e){if("__divider__"===e)d.push(c());else if("_"!==e.charAt(0)){var g=b(e,function(){NGL.ExampleRegistry.load(e,a)});d.push(g)}});var e=UI.MenubarHelper.createOptionsPanel(d);return UI.MenubarHelper.createMenuContainer("Examples",e)};
NGL.MenubarPluginsWidget=function(a){var b=UI.MenubarHelper.createOption,c=[];NGL.PluginRegistry.names.sort().forEach(function(d){var f=b(d,function(){NGL.PluginRegistry.load(d,a)});c.push(f)});var d=UI.MenubarHelper.createOptionsPanel(c);return UI.MenubarHelper.createMenuContainer("Plugins",d)};
NGL.MenubarHelpWidget=function(a){function b(){d.setOpacity("0.9").setLeft("50px").setTop("80px").setDisplay("block")}var c=(new NGL.PreferencesWidget(a)).setDisplay("none").attach(),d=(new NGL.OverviewWidget(a)).setDisplay("none").attach();a.preferences.getKey("overview")&&b();a=UI.MenubarHelper.createOption;var e=UI.MenubarHelper.createDivider;a=[a("Overview",b),a("Documentation",function(){window.open(NGL.assetsDirectory+"doc/index.html","_blank")}),e(),a("Prefereces",function(){c.setOpacity("0.9").setLeft("50px").setTop("80px").setDisplay("block")},
"sliders")];a=UI.MenubarHelper.createOptionsPanel(a);return UI.MenubarHelper.createMenuContainer("Help",a)};
NGL.OverviewWidget=function(a){function b(a,b){var c=new UI.Panel,d=(new UI.Icon(a)).setWidth("20px").setFloat("left"),f=(new UI.Text(b)).setDisplay("inline").setMarginLeft("5px");c.setMarginLeft("20px").add(d,f);e.add(c)}var c=new UI.OverlayPanel,d=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("25px"),e=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setMaxWidth("600px").setOverflow("auto");d.add((new UI.Text("NGL Viewer")).setFontStyle("italic"),new UI.Html("&nbsp;&mdash;&nbsp;Overview"));
d.add((new UI.Icon("times")).setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick(function(){c.setDisplay("none")}));c.add(d);c.add(e);e.add((new UI.Panel).add(new UI.Html("To load a new structure use the <i>File</i> menu in the top left via drag'n'drop."))).add(new UI.Break);e.add((new UI.Panel).add(new UI.Text("A number of clickable icons provide common actions. Most icons can be clicked on, just try it or hover the mouse pointer over it to see a tooltip."))).add(new UI.Break);b("eye",
"Controls the visibility of a component.");b("trash-o","Deletes a component. Note that a second click is required to confirm the action.");b("bullseye","Centers a component.");b("bars","Opens a menu with further options.");b("square","Opens a menu with coloring options.");b("filter","Indicates atom-selection input fields.");e.add(new UI.Text("Mouse controls")).add(new UI.Html("<ul><li>Left button hold and move to rotate camera around center.</li><li>Left button click to pick atom.</li><li>Middle button hold and move to zoom camera in and out.</li><li>Middle button click to center camera on atom.</li><li>Right button hold and move to translate camera in the screen plane.</li></ul>"));
d=NGL.assetsDirectory+"doc/index.html";e.add((new UI.Panel).add(new UI.Html("For more information please visit the <a href='"+d+"' target='_blank'>documentation pages</a>.")));var d=a.preferences.getKey("overview"),f=(new UI.Checkbox(d)).onClick(function(){a.preferences.setKey("overview",f.getValue())});e.add((new UI.HorizontalRule).setBorderTop("1px solid #555").setMarginTop("15px")).add((new UI.Panel).add(f,(new UI.Text("Show on startup. Always available from Menu > Help > Overview.")).setMarginLeft("5px")));
return c};
NGL.PreferencesWidget=function(a){function b(a,b){e.add((new UI.Text(a)).setWidth("80px")).add(b||new UI.Panel).add(new UI.Break)}var c=a.preferences,d=new UI.OverlayPanel;a=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("25px");var e=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");a.add(new UI.Text("Preferences"));a.add((new UI.Icon("times")).setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick(function(){d.setDisplay("none")}));d.add(a);
d.add(e);var f=(new UI.Select).setOptions({dark:"dark",light:"light"}).setValue(c.getKey("theme")).onChange(function(){c.setTheme(f.getValue())}),g=(new UI.Select).setOptions({low:"low",medium:"medium",high:"high"}).setValue(c.getKey("quality")).onChange(function(){c.setQuality(g.getValue())}),h=(new UI.Checkbox).setValue(c.getKey("impostor")).onChange(function(){c.setImpostor(h.getValue())});b("theme",f);b("quality",g);b("impostor",h);return d};
NGL.ExportImageWidget=function(a){function b(a,b){e.add((new UI.Text(a)).setWidth("80px")).add(b||new UI.Panel).add(new UI.Break)}var c=new UI.OverlayPanel,d=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("25px"),e=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");d.add(new UI.Text("Image export"));d.add((new UI.Icon("times")).setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick(function(){c.setDisplay("none")}));c.add(d);
c.add(e);var f=(new UI.Select).setOptions({1:"1x",2:"2x",3:"3x",4:"4x",5:"5x",6:"6x",7:"7x",8:"8x",9:"9x",10:"10x"}).setValue("4");(new UI.Select).setOptions({"image/png":"PNG","image/jpeg":"JPEG"}).setValue("image/png");(new UI.Select).setOptions({"0.1":"0.1","0.2":"0.2","0.3":"0.3","0.4":"0.4","0.5":"0.5","0.6":"0.6","0.7":"0.7","0.8":"0.8","0.9":"0.9","1.0":"1.0"}).setValue("1.0");var g=(new UI.Checkbox).setValue(!0),h=(new UI.Checkbox).setValue(!1),l=(new UI.Checkbox).setValue(!1),k=(new UI.Progress).setDisplay("none"),
m=(new UI.Button("export")).onClick(function(){m.setDisplay("none");k.setDisplay("inline-block");setTimeout(function(){a.exportImage(parseInt(f.getValue()),g.getValue(),h.getValue(),l.getValue(),function(a,b,c){1===a&&k.setMax(b);a>=b?k.setIndeterminate():k.setValue(a);c&&(k.setDisplay("none"),m.setDisplay("inline-block"))})},50)});b("scale",f);b("antialias",g);b("transparent",h);b("trim",l);e.add(new UI.Break,m,k);return c};
NGL.SidebarWidget=function(a){var b=a.signals,c=new UI.Panel,d=(new UI.Panel).setClass("Content"),e=[],f=[];b.componentAdded.add(function(b){var c;if(b instanceof NGL.StructureComponent)c=new NGL.StructureComponentWidget(b,a);else if(b instanceof NGL.SurfaceComponent)c=new NGL.SurfaceComponentWidget(b,a);else if(b instanceof NGL.ScriptComponent)c=new NGL.ScriptComponentWidget(b,a);else if(b instanceof NGL.Component)c=new NGL.ComponentWidget(b,a);else{NGL.warn("NGL.SidebarWidget: component type unknown",
b);return}d.add(c);e.push(b);f.push(c)});b.componentRemoved.add(function(a){a=e.indexOf(a);-1!==a&&(f[a].dispose(),e.splice(a,1),f.splice(a,1))});var b=(new UI.Icon("plus-square")).setTitle("expand all").setCursor("pointer").onClick(function(){f.forEach(function(a){a.expand()})}),g=(new UI.Icon("minus-square")).setTitle("collapse all").setCursor("pointer").setMarginLeft("10px").onClick(function(){f.forEach(function(a){a.collapse()})}),h=(new UI.Icon("bullseye")).setTitle("center all").setCursor("pointer").setMarginLeft("10px").onClick(function(){a.centerView()}),
l=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){a.removeAllComponents()}),k=(new UI.PopupMenu("cogs","Settings","window")).setIconTitle("settings").setMarginLeft("10px"),m=(new UI.Panel).setDisplay("inline").add((new UI.Icon("spinner")).addClass("spin").setMarginLeft("45px"));a.tasks.signals.countChanged.add(function(a,b){if(0<b)s.add(m);else try{s.remove(m)}catch(c){}});var r=(new UI.Range(1,100,a.viewer.params.clipNear,1)).onInput(function(){a.viewer.setClip(r.getValue(),
t.getValue())}),t=(new UI.Range(1,100,a.viewer.params.clipFar,1)).onInput(function(){a.viewer.setClip(r.getValue(),t.getValue())}),q=(new UI.Range(1,100,a.viewer.params.clipDist,1)).onInput(function(){a.viewer.params.clipDist=q.getValue();a.viewer.requestRender()}),p=(new UI.Range(1,100,a.viewer.params.fogNear,1)).onInput(function(){a.viewer.setFog(null,p.getValue(),n.getValue())}),n=(new UI.Range(1,100,a.viewer.params.fogFar,1)).onInput(function(){a.viewer.setFog(null,p.getValue(),n.getValue())});
k.addEntry("clip near",r).addEntry("clip far",t).addEntry("clip distance",q).addEntry("fog near",p).addEntry("fog far",n);var s=(new UI.Panel).setClass("Panel Sticky").add(b,g,h,l,k);c.add(s,d);return c};
NGL.ComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file");c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.statusChanged.add(function(b){b={404:"Error: file not found"}[a.status]||a.status;d.setCollapsed(!1);d.add((new UI.Text(b)).setMarginLeft("20px").setWidth("200px").setWordWrap("break-word"));d.removeStatic(e);d.addStatic(f)});var c=(new UI.EllipsisText(NGL.unicodeHelper(a.name))).setWidth("100px"),e=(new UI.Panel).setDisplay("inline").add((new UI.Icon("spinner")).addClass("spin").setMarginLeft("25px")),
f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)});d.addStatic(c,e);return d};
NGL.StructureComponentWidget=function(a,b){function c(){var c={"":"[ structure ]"};b.eachComponent(function(b,d){b!==a&&(c[d]=NGL.unicodeHelper(b.name))},NGL.StructureComponent);m.setOptions(c)}var d=a.signals,e=new UI.CollapsibleIconPanel("file"),f=new UI.Panel,g=new UI.Panel;d.requestGuiVisibility.add(function(a){e.setCollapsed(!a)});d.representationAdded.add(function(a){f.add(new NGL.RepresentationComponentWidget(a,b))});d.trajectoryAdded.add(function(a){g.add(new NGL.TrajectoryComponentWidget(a,
b))});e.add((new UI.SelectionPanel(a.selection)).setMarginLeft("20px").setInputWidth("214px"));var d=(new UI.Button("export")).onClick(function(){(new NGL.PdbWriter(a.structure)).download("structure");q.setMenuDisplay("none")}),h=(new UI.Select).setColor("#444").setOptions(function(){var a={"":"[ add ]"},b;for(b in NGL.representationTypes)a[b]=b;return a}()).onChange(function(){a.addRepresentation(h.getValue());h.setValue("");q.setMenuDisplay("none")}),l=(new UI.Select).setColor("#444").setOptions(function(){var b=
{__AU:"AU"};Object.keys(a.structure.biomolDict).forEach(function(a){b[a]=a});return b}()).setValue(a.structure.defaultAssembly).onChange(function(){a.structure.setDefaultAssembly(l.getValue());a.rebuildRepresentations();q.setMenuDisplay("none")}),k=(new UI.Button("import")).onClick(function(){q.setMenuDisplay("none");var c=["xtc","trr","dcd","netcdf","nc"],d;d=new NGL.DirectoryListingWidget(NGL.DatasourceRegistry.listing,b,"Import trajectory",c,function(b){var e=b.path.split(".").pop().toLowerCase();
-1!==c.indexOf(e)?(a.addTrajectory(b.path),d.dispose()):NGL.log("unknown trajectory type: "+e)});d.setOpacity("0.9").setLeft("50px").setTop("80px").attach()});b.signals.componentAdded.add(c);b.signals.componentRemoved.add(c);var m=(new UI.Select).setColor("#444").onChange(function(){a.superpose(b.compList[m.getValue()],!0);a.centerView();m.setValue("");q.setMenuDisplay("none")});c();var r=(new UI.Button("calculate")).onClick(function(){a.structure.autoSS();a.rebuildRepresentations();q.setMenuDisplay("none")}),
t=(new UI.Button("duplicate")).onClick(function(){b.addComponent(new NGL.StructureComponent(b,a.structure.clone()));q.setMenuDisplay("none")}),q=(new UI.ComponentPanel(a)).setDisplay("inline-block").setMargin("0px").addMenuEntry("PDB file",d).addMenuEntry("Representation",h).addMenuEntry("Assembly",l).addMenuEntry("Superpose",m).addMenuEntry("SS",r).addMenuEntry("Structure",t).addMenuEntry("File",(new UI.Text(a.structure.path)).setMaxWidth("100px").setOverflow("auto"));NGL.DatasourceRegistry.listing&&
NGL.DatasourceRegistry.trajectory&&q.addMenuEntry("Trajectory",k);e.addStatic(q).add(g).add(f);return e};
NGL.SurfaceComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file"),e=new UI.Panel;c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.representationAdded.add(function(a){e.add(new NGL.RepresentationComponentWidget(a,b))});var f=(new UI.Select).setColor("#444").setOptions({"":"[ add ]",surface:"surface",dot:"dot"}).onChange(function(){a.addRepresentation(f.getValue());f.setValue("");g.setMenuDisplay("none")}),g=(new UI.ComponentPanel(a)).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",
f).addMenuEntry("File",(new UI.Text(a.surface.path)).setMaxWidth("100px").setWordWrap("break-word"));d.addStatic(g).add(e);return d};
NGL.ScriptComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file"),e=(new UI.Panel).setMarginLeft("20px");c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.nameChanged.add(function(a){g.setValue(NGL.unicodeHelper(a))});c.statusChanged.add(function(a){"finished"===a&&(d.removeStatic(h),d.addStatic(f))});a.script.signals.elementAdded.add(function(a){e.add.apply(e,a)});var f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)}),
g=(new UI.EllipsisText(NGL.unicodeHelper(a.name))).setWidth("100px"),h=(new UI.Icon("spinner")).addClass("spin").setMarginLeft("25px");d.addStatic(g).addStatic(h);d.add(e);return d};
NGL.RepresentationComponentWidget=function(a,b){var c=a.signals,d=(new UI.CollapsibleIconPanel("bookmark")).setMarginLeft("20px");c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.visibilityChanged.add(function(a){f.setValue(a)});c.nameChanged.add(function(a){e.setValue(NGL.unicodeHelper(a))});c.disposed.add(function(){h.dispose();d.dispose()});var e=(new UI.EllipsisText(NGL.unicodeHelper(a.name))).setWidth("103px"),f=(new UI.ToggleIcon(a.visible,"eye","eye-slash")).setTitle("hide/show").setCursor("pointer").setMarginLeft("25px").onClick(function(){a.setVisibility(!a.visible)}),
g=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){a.dispose()});d.addStatic(e).addStatic(f).addStatic(g);(a.parent instanceof NGL.StructureComponent||a.parent instanceof NGL.TrajectoryComponent)&&a.repr.selection instanceof NGL.Selection&&d.add((new UI.SelectionPanel(a.repr.selection)).setMarginLeft("20px").setInputWidth("194px"));var h=(new UI.PopupMenu("bars","Representation")).setMarginLeft("45px").setEntryLabelWidth("130px");h.addEntry("type",new UI.Text(a.repr.type));
Object.keys(a.repr.parameters).forEach(function(b){var d=a.repr,e,f=d.parameters[b];f&&("number"===f.type||"integer"===f.type?(e="number"===f.type?(new UI.Number(parseFloat(d[b])||NaN)).setPrecision(f.precision):new UI.Integer(parseInt(d[b])||NaN),e.setRange(f.min,f.max)):"boolean"===f.type?e=new UI.Checkbox(d[b]):"text"===f.type?e=new UI.Input(d[b]):"select"===f.type?e=(new UI.Select).setWidth("").setOptions(f.options).setValue(d[b]):"button"===f.type?e=(new UI.Button(b)).onClick(function(){d[b]()}):
"color"===f.type?e=(new UI.ColorPopupMenu(b)).setValue(d[b]):"hidden"!==f.type&&NGL.warn("NGL.RepresentationComponentWidget: unknown parameter type '"+f.type+"'"),e&&(c.parametersChanged.add(function(a){e.setValue(a[b])}),e.onChange(function(){var c={};c[b]=e.getValue();a.setParameters(c);d.viewer.requestRender()}),h.addEntry(b,e)))});d.addStatic(h);return d};
NGL.TrajectoryComponentWidget=function(a,b){function c(a){h.clear().add(k.setWidth("70px"));k.setRange(-1,a-1);r.setRange(-1,a-1);m.setValue(Math.ceil((a+1)/100));n.step=m.getValue();n.end=a}var d=a.signals,e=a.trajectory,f=(new UI.CollapsibleIconPanel("database")).setMarginLeft("20px"),g=new UI.Panel;d.representationAdded.add(function(a){g.add(new NGL.RepresentationComponentWidget(a,b))});d.disposed.add(function(){x.dispose();f.dispose()});var h=(new UI.Panel).setMarginLeft("10px").setDisplay("inline").add((new UI.Icon("spinner")).addClass("spin").setMarginRight("69px"));
d.gotNumframes.add(c);d.frameChanged.add(function(a){k.setValue(a);r.setValue(a);h.clear().add(k.setWidth("70px"))});var l=(new UI.EllipsisText(e.name)).setWidth("108px");f.addStatic(l);f.addStatic(h);var k=(new UI.Integer(-1)).setMarginLeft("5px").setWidth("70px").setRange(-1,-1).onChange(function(a){e.setFrame(k.getValue());x.setMenuDisplay("none")}),m=(new UI.Integer(1)).setWidth("30px").setRange(1,1E4).onChange(function(){n.step=m.getValue()}),l=new UI.Panel,r=(new UI.Range(-1,-1,-1,1)).setWidth("197px").setMargin("0px").setPadding("0px").setBorder("0px").onInput(function(a){a=
r.getValue();a!==e.currentFrame&&(e.player&&e.player._running?(e.setPlayer(),e.setFrame(a)):e.inProgress||e.setFrame(a))}),t=(new UI.Select).setColor("#444").setOptions({"":"none",linear:"linear",spline:"spline"}).onChange(function(){n.interpolateType=t.getValue()}),q=(new UI.Integer(5)).setWidth("30px").setRange(1,50).onChange(function(){n.interpolateStep=q.getValue()}),p=(new UI.Integer(50)).setWidth("30px").setRange(10,1E3).onChange(function(){n.timeout=p.getValue()}),n=new NGL.TrajectoryPlayer(e,
m.getValue(),p.getValue(),0,e.numframes),s=(new UI.ToggleIcon(!0,"play","pause")).setMarginRight("10px").setMarginLeft("20px").setCursor("pointer").setWidth("12px").setTitle("play").onClick(function(){n.toggle()});n.signals.startedRunning.add(function(){s.setTitle("pause").setValue(!1)});n.signals.haltedRunning.add(function(){s.setTitle("play").setValue(!0)});l.add(s);l.add(r);var y=(new UI.Select).setColor("#444").setOptions({forward:"forward",backward:"backward"}).onChange(function(){n.direction=
y.getValue()}),z=(new UI.Select).setColor("#444").setOptions({loop:"loop",once:"once"}).onChange(function(){n.mode=z.getValue()});f.add((new UI.SelectionPanel(e.selection)).setMarginLeft("20px").setInputWidth("194px"));var u=(new UI.Checkbox(e.params.centerPbc)).onChange(function(){a.setParameters({centerPbc:u.getValue()})}),v=(new UI.Checkbox(e.params.removePbc)).onChange(function(){a.setParameters({removePbc:v.getValue()})}),w=(new UI.Checkbox(e.params.superpose)).onChange(function(){a.setParameters({superpose:w.getValue()})});
d.parametersChanged.add(function(a){u.setValue(a.centerPbc);v.setValue(a.removePbc);w.setValue(a.superpose)});(new UI.Button("download")).onClick(function(){e.download(m.getValue())});var d=(new UI.Button("add")).onClick(function(){a.addRepresentation()}),A=(new UI.DisposeIcon).setDisposeFunction(function(){a.parent.removeTrajectory(a)});e.numframes&&c(e.numframes);var x=(new UI.PopupMenu("bars","Trajectory")).setMarginLeft("10px").setEntryLabelWidth("130px").addEntry("Path",d).addEntry("Center",
u).addEntry("Remove PBC",v).addEntry("Superpose",w).addEntry("Step size",m).addEntry("Interpolation type",t).addEntry("Interpolation steps",q).addEntry("Play timeout",p).addEntry("Play direction",y).addEntry("Play mode",z).addEntry("File",(new UI.Text(e.trajPath)).setMaxWidth("100px").setWordWrap("break-word")).addEntry("Dispose",A);f.addStatic(x);f.add(l);f.add(g);return f};
NGL.DirectoryListingWidget=function(a,b,c,d,e){function f(a,b,c,d,e){return(b=Math,c=b.log,d=1E3,e=c(a)/c(d)|0,a/b.pow(d,e)).toFixed(2)+String.fromCharCode(160)+(e?"kMGTPEZY"[--e]+"B":"Bytes")}function g(a){var b={"":""},c=[];(a||"").split("/").forEach(function(a){c.push(a);b[c.join("/")]=a});return b}function h(b){var c=b.path;b=b.data;NGL.lastUsedDirectory=c;k.clear();m.setOptions(g(c)).setValue(c);b.forEach(function(b){var c=b.path.split(".").pop().toLowerCase();if(!d||b.dir||-1!==d.indexOf(c)){var g;
b.dir?(c="folder-o",g=b.name):(c="file-o",g=b.name+String.fromCharCode(160)+"("+f(b.size)+")");c=(new UI.Panel).setDisplay("block").setWhiteSpace("nowrap").add((new UI.Icon(c)).setWidth("20px")).add(new UI.Text(g)).onClick(function(){b.dir?a.getListing(b.path).then(h):e(b)});b.restricted&&c.add((new UI.Icon("lock")).setMarginLeft("5px"));k.add(c)}})}var l=new UI.OverlayPanel;b=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("30px");var k=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setPaddingRight("15px").setOverflow("auto"),
m=(new UI.Select).setColor("#444").setMarginLeft("20px").setWidth("").setMaxWidth("200px").setOptions(g()).onChange(function(){a.getListing(m.getValue()).then(h)});b.add(new UI.Text(c||"Directoy listing"));b.add(m);b.add((new UI.Icon("times")).setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick(function(){l.dispose()}));l.add(b);l.add(k);a.getListing(NGL.lastUsedDirectory).then(h);return l};

